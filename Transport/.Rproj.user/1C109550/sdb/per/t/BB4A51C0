{
    "contents" : "library(dplyr)\nlibrary(tidyr)\n\n#load data\nKSIC.KAIST=read.csv(file=\"KCIS_KAIST.csv\",header=T,as.is=T)\nIO.KSIC=read.csv(file=\"2010_IO_KCIS.csv\",header=T,as.is=T)\nIO.KSIC.m=read.csv(file=\"2010_IO_KCIS_m.csv\",header=T,as.is=T)\nIO.model=read.csv(\"indcode_20160616.csv\",header=T,as.is=T)\nKSIC.name=KSIC.KAIST[,(9:10)]\nKSIC_ind=unique(KSIC.name[,1])\nKSIC.name.dict={}\nfor (ki in 1:length(KSIC_ind)){\nKSIC_ind_i=KSIC_ind[ki]\nKSIC_n_i=paste(unique(KSIC.name[KSIC.name[,1]==KSIC_ind_i,2]),collapse=\" & \")\nnind_i=cbind(KSIC_ind_i,KSIC_n_i)\nKSIC.name.dict=rbind(KSIC.name.dict,nind_i)\n}\nKSIC.name.dict=data.frame(KSIC.name.dict)\ncolnames(KSIC.name.dict)=c(\"Tiny\",\"Tiny_name\")\n\nIO.name_row=IO.model[,(1:2)]\nIO.name_col=IO.model[,(4:5)]\nmodel.name=IO.model[,(7:8)]\nIO.name_row=IO.name_row[!is.na(IO.name_row[,1]),]\nmodel.name=model.name[!is.na(model.name[,1]),]\n\n## Step 1. IO_model_KCIS\n#trim IO_model\nIO.model=IO.model[,c(1,3)]\nIO.model=IO.model[(1:384),]\n#integrate IO_KSIC\nIO.KSIC=IO.KSIC[,(2:3)]\n\nIO.KSIC.m_data={}\n\nfor (i in 1:length(IO.KSIC.m)){\nbasei=IO.KSIC.m[i,1]\nbegin_i=IO.KSIC.m[i,\"KCIS_begin\"]\nend_i=IO.KSIC.m[i,\"KCIS_end\"]\nci=(begin_i:end_i)\ndata_i=cbind(rep(basei,length(ci)),ci)\nIO.KSIC.m_data=rbind(IO.KSIC.m_data,data_i)\n}\n\nIO.KSIC.m_data=data.frame(IO.KSIC.m_data)\ncolnames(IO.KSIC.m_data)=colnames(IO.KSIC)\nIO.KSIC=rbind(IO.KSIC,IO.KSIC.m_data)\n\n# merge IO_model with IO_KSIC\nIO_model_KSIC=merge(IO.model,IO.KSIC,by.x=\"basecode_row\",by.y=\"basecode_fill\",all=T)\n\n# merge with sector name\n\nIO_model_KSIC.N=merge(IO_model_KSIC,model.name, by.x=\"sector_row\",by.y=\"sector_ind\",all=T,sort=FALSE)\n\n\n# Step 2. obtain KSIC_model\nNKSIC=length(unique(IO_model_KSIC$KCIS))\nUKSIC=unique(IO_model_KSIC$KCIS)\n\nKSIC_model={}\n\nfor (i in 1:NKSIC){\n  UKSIC_i=UKSIC[i]\nIO_i=IO_model_KSIC.N[IO_model_KSIC.N$KCIS==UKSIC_i,\"basecode_row\"]\nIO_i=unique(IO_i)\nIO_i=paste(IO_i,collapse=\" & \")\nN_i=IO_model_KSIC.N[IO_model_KSIC.N$KCIS==UKSIC_i,\"sector_name\"]\nN_i=unique(N_i)\nN_i=paste(N_i,collapse=\" & \")\nS_i=IO_model_KSIC.N[IO_model_KSIC.N$KCIS==UKSIC_i,\"sector_row\"]\nS_i=unique(S_i)\nS_i=paste(S_i,collapse=\" & \")\nD_i=data.frame(cbind(UKSIC_i,N_i,S_i,IO_i))\nKSIC_model=rbind(KSIC_model,D_i)\n}\n\n#step 3. Obtain KAIST KSIC_model\n\nKSIC_KAIST.s=KSIC.KAIST[,c(9,10,15)]\n\nKSIC.m=merge(KSIC_model,KSIC_KAIST.s, by.x=\"UKSIC_i\",by.y=\"Tiny\",all=T)\ncolnames(KSIC.m)=c(\"KSICcode\",\"CGE_name_mapp\",\"CGE_code_mapp\",\"IO_code\",\"KSIC_name\",\"CGE_code_actual\")\n\n\nKSIC.m.diffmodel=KSIC.m[(KSIC.m[,2]!=KSIC.m[,6]),]\nKSIC.m.diffmodel.s=KSIC.m.diffmodel[!is.na(KSIC.m.diffmodel[,1]),]\nKSIC.m.diffmodel.NA=KSIC.m.diffmodel[is.na(KSIC.m.diffmodel[,1]),]\nwrite.csv(KSIC.m.diffmodel.s, file=\"diff_small.csv\")\nwrite.csv(KSIC.m.diffmodel.NA,file=\"diff_large.csv\")\n\nKSIC.m.core=KSIC.m[!is.na(KSIC.m[,1]) & !is.na(KSIC.m[,6]),]\nKSIC.m.core=KSIC.m.core[order(KSIC.m.core[,1]),]\nKSIC.m.core=KSIC.m.core %>% select(KSICcode, KSIC_name,CGE_code_actual,CGE_code_mapp,CGE_name_mapp)\nKSIC.m.core=KSIC.m.core[!duplicated(KSIC.m.core),]\nsave(KSIC.m.core, file=\"KSIC-IO-model.mapping.rdata\")",
    "created" : 1467162686477.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3137977014",
    "id" : "BB4A51C0",
    "lastKnownWriteTime" : 1466308573,
    "path" : "C:/Users/sungw/OneDrive/work_2016/0000_Hybrid_2nd/CGE/SAM/IND/checkmodel_KAIST.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}