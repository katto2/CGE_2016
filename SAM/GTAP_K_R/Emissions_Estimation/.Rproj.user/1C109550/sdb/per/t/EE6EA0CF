{
    "contents" : "### This file replace Emission_Estimation.gms\n##(1) Construct Energy_IO A table and Final Demand\n##(2) Construct GHG_IO A table, GHG_IO Final Demand, GHG by industry\n##(3) Rescaling\n##(4) Produce GHG stats\n\n##(0) Load related data\n#(0-i) IO and Energy Balance\nt=2010\nE_name1=paste(paste(\"IO_E\",t,sep=\"_\"),\"Rdata\",sep=\".\")\nload(E_name1)\n#(0-ii) Emission Factor converting Energy to CO2\nEF=read.csv(file=file.path(\"Emissions_Estimation\",\"EF.csv\"), header=T,as.is=T)\nEF_ind=merge(ENGind_index,EF,by.x=\"basecode_row\", by.y=\"ind\",all=T)\n\n##(1) Construct Energy_IO A table\n##(1-i) prepare IO values\n###(a) call IO value to distribute/designate\nDist=con_totB[ENGind_index$basecode_col,]# To distribute\nDist=data.frame(Dist)\nrownames(Dist)=ENGind_index$basecode_col\nDesig_ind=c(\"X26\",\"X27\",\"X101\",\"X106\",\"X279\")#industries with designated value\nDesig_M=con_totB[Desig_ind,]#To be substracte for designation\nDesig_M=data.frame(Desig_M)\nrownames(Desig_M)=Desig_ind\n###(b) construct values to designate\nDesig_M[\"X26\",]=sum(A_T_B_384[26,c(\"X100\",\"X275\")]) #Anthrachite in Yuntan and Thermal_generation\nDesig_M[\"X27\",]=A_T_B_384[27,\"X275\"]#Bituminus in Thermal_generation\nDesig_M[\"X101\",]=sum(A_T_B_384[101,paste(\"X\",(111:139),sep=\"\")])#Naphta in Petrochemical products\nDesig_M[\"X106\",]=A_T_B_384[106,\"X275\"]#Heavy Oil in Thermal_generation\nDesig_M[\"X279\",]=sum(A_T_B_384[279,c(\"X275\",\"X280\")])#Towngas in Thermal generatio and Heat and Water\n###(c) construct values to distribute\nDist[Desig_ind,]=Dist[Desig_ind,]-Desig_M[Desig_ind,]\n\n##(1-ii) prepare E values\n###(a) call E values to distribute\nDist_E=con_ene\n###(b) construct Evvalues to designate\nDesig_Anthrat=abs(EBS_LLH[c(\"Residential\",\"E_Gene\"),\"AnthraT\"]) #Antharchite in Yuntan (Residential) and Thermal Generation\nDesig_Bitu=-EBS_LLH[\"E_Gene\",\"BituT\"]#Bituminous coal in thermal electricity generation\nDesig_Naphta=EBS_LLH[\"PetChem\",\"Naphta\"]#Naphta in Petro chemical production\nDesig_Heavyoil=-1*EBS_LLH[\"E_Gene\",c(\"BA\",\"BB\",\"BC\")]# Heavy oil in thermal electricity generation\nDesig_Towngas=-1*EBS_LLH[c(\"E_Gene\",\"Heating\"),c(\"LNG\",\"TownGas\")]# LNG and Towngas in thermal elec and Heating\n#(LNG used in E_Gene and Heating is not captured in IO. We subtract it from Towngas instead)\nDesig_E_list=list(Desig_Anthrat,Desig_Bitu,Desig_Naphta,Desig_Heavyoil,Desig_Towngas)\n\nDesig_E=data.frame(sapply(Desig_E_list,FUN=sum))\nrownames(Desig_E)=Desig_ind\ncolnames(Desig_E)=\"Desig_E\"\n\n###(c) construct E values to distribute\nDist_E[Desig_ind,]=Dist_E[Desig_ind,]-Desig_E[Desig_ind,]\n\n\n##(1-iii) Construct Energy IO A table\n###(a) Distribute E (Non Designated)\n# E_ij =[M_ij/(M-M_designated)]*(E-E_designated)\nIOT_energy=diag(Dist_E[,1])%*%solve(diag(Dist[,1]))%*%as.matrix(A_T_B_384[ENGind_index$basecode_row,])\nIOT_energy=data.frame(IOT_energy)\nrownames(IOT_energy)=EF_ind$basecode_col\n#x275(Thermal E),X277(self E) came from E_Fcon+E_Gene-Hyrdo-Nuclear-Renewable E. We distribute this E to x275 and x277\n# E_ij=[M_ij/M275+M277-(M275+M277|Designated)]*[E275+E277-(E275+E277|Designated)]\nIOT_energy[\"X275\",]=(A_T_B_384[275,]/(sum(Dist[c(\"X275\",\"X277\"),])))*sum(Dist_E[c(\"X275\",\"X277\"),])\nIOT_energy[\"X277\",]=(A_T_B_384[277,]/(sum(Dist[c(\"X275\",\"X277\"),])))*sum(Dist_E[c(\"X275\",\"X277\"),])\n\n\n###(c) Designated E_ij\nIOT_energy[\"X26\",c(\"X100\",\"X275\")]=Desig_E_list[[1]] #Anthrachite in Yuntan and Thermal_generation\nIOT_energy[\"X27\",\"X275\"]=Desig_E_list[[2]]#Bituminus in Thermal_generation\nIOT_energy[\"X101\",paste(\"X\",(111:139),sep=\"\")]=Desig_E_list[[3]]*A_T_B_384[101,paste(\"X\",(111:139),sep=\"\")]/sum(A_T_B_384[101,paste(\"X\",(111:139),sep=\"\")])#Naphta in Petrochemical products\nIOT_energy[\"X106\",\"X275\"]=sum(Desig_E_list[[4]])#Heavy Oil in Thermal_generation\nIOT_energy[\"X279\",c(\"X275\",\"X280\")]=as.numeric(rowSums(Desig_E_list[[5]]))#Towngas in Thermal generatio and Heat and Water\n\n##(1-iv) Construct Energy IO Final Demand\nIOT_energy_FinD=data.frame(matrix(rep(0,dim(IOT_energy)[1]*dim(F_T_B_384)[2]),dim(IOT_energy)[1],dim(F_T_B_384)[2]))\ncolnames(IOT_energy_FinD)=Fin_Demand\nrownames(IOT_energy_FinD)=EF_ind$basecode_col\nIOT_energy_FinD_Pc=(F_T_B_384[ENGind_index$basecode_row,\"Final_Pc\"]/Dist)*Dist_E\nIOT_energy_FinD_Pc[\"X275\",]=(F_T_B_384[275,\"Final_Pc\"]/sum(Dist[c(\"X275\",\"X277\"),]))*sum(Dist_E[c(\"X275\",\"X277\"),])\nIOT_energy_FinD_Pc[\"X277\",]=(F_T_B_384[277,\"Final_Pc\"]/sum(Dist[c(\"X275\",\"X277\"),]))*sum(Dist_E[c(\"X275\",\"X277\"),])\n\nIOT_energy_FinD$Final_Pc=IOT_energy_FinD_Pc\nIOT_energy_FinD$Final_Tot=IOT_energy_FinD_Pc\ncolnames(IOT_energy_FinD)=Fin_Demand\n##(1-v) check if the sum of energy distributed matches with con_ene\ncheck_E=max(abs(rowSums(IOT_energy)+IOT_energy_FinD$Final_Tot-con_ene))\nprint(\"check_E=\")\nprint(check_E)\nif (check_E>0.000001) {\n  print (\"The rowsum of IOT_energy doesn't match with con_ene\")\n}\n\n##(2) Construct GHG_IO A table, GHG_IO Final Demand, GHG by industry\n###(2-i) preparing related data\n#IOT_E_GHG=IOT_energy # preparing IOT_energy used for GHG estimation\n#IOT_E_GHG_FinD=IOT_energy_FinD\nEF_ind$EF_adj=EF_ind$EF*(44/12)*(1-EF_ind$Sink) # adjusting emission factor . 44/12 converts CO to CO2, 1-sink takes out sinking Carbons in Naphta and Lubricant\n###(2-ii) Excluding double counted Energy from IOT_E_GHG(Not Necessary)\n#IOT_E_GHG[c(\"X26\",\"X27\"),c(\"X99\",\"X100\")]=0 # Coals used in coal products. Emission is captured when coal products are used.\n#IOT_E_GHG[\"X280\",]=0 \n#IOT_E_GHG_FinD[\"X280\",]=0 # zero emission in heat using. Carbon is captured when Heat is produced.\n###(2-ii)Preparing non counting dummy matrix for GHG_IO A table\nDel_Dummy=matrix(rep(1, dim(IOT_energy)[1]*dim(IOT_energy)[2]),dim(IOT_energy)[1],dim(IOT_energy)[2])\nrownames(Del_Dummy)=rownames(IOT_energy)\ncolnames(Del_Dummy)=colnames(IOT_energy)\n####(a) Transformed energy doesn't emit GHG (X274-X278 Elec, X280 Heat)\nDel_Dummy[c(paste(\"X\",(274:278),sep=\"\"),\"X280\"),]=0\n####(b) coal used in Coal product(X99) and coal briquettes(X100) doesn't emit GHG. Carbons remain in Coal Products and Coal briquet\nDel_Dummy[c(\"X26\",\"X27\"),c(\"X99\",\"X100\")]=0\n####(c) Crud oil used in refinary oil production(X101~X110) doesn't emit GHG. Carbons remain in refinary products\nDel_Dummy[\"X28\",paste(\"X\",(101:110),sep=\"\")]=0\n####(e) LNG used in Towngas production doesn't emit GHG. Carbons remain in Towngas\n#### Notice that we assigned primary consumption of LNG in Towngas, so that we can capture LNG not used in Towngas production\nDel_Dummy[\"X29\",\"X279\"]=0\n\n##(2-iv) Obtain GHG IO A table Emit_Dir0, Emit_Dir1\n\nIOT_E_GHG=IOT_energy*Del_Dummy\n\nEmit_Dir0=data.frame(diag(EF_ind$EF_adj)%*%as.matrix(IOT_E_GHG))\nrownames(Emit_Dir0)=rownames(IOT_energy)\n\n\n##(2-v) obtain GHG IO Final Demand Emit_Dir0_FinD, Emit_Dir1_FinD\n\nDel_Dummy_FinD=matrix(rep(1,dim(IOT_energy_FinD)[1]*dim(IOT_energy_FinD)[2]),dim(IOT_energy_FinD)[1],dim(IOT_energy_FinD)[2])\nrownames(Del_Dummy_FinD)=rownames(IOT_energy_FinD)\ncolnames(Del_Dummy_FinD)=colnames(IOT_energy_FinD)\n#### Transformed energy doesn't emit GHG in Final Consumption (X274-X278 Elec, X280 Heat)\nDel_Dummy_FinD[c(paste(\"X\",(274:278),sep=\"\"),\"X280\"),]=0\n\nIOT_E_GHG_FinD=IOT_energy_FinD*Del_Dummy_FinD\n\nEmit_Dir0_FinD=data.frame(diag(EF_ind$EF_adj)%*%as.matrix(IOT_E_GHG_FinD))\ncolnames(Emit_Dir0_FinD)=Fin_Demand\nrownames(Emit_Dir0_FinD)=rownames(IOT_energy_FinD)\n\n\n##(3) Rescaling (from kton to ton)\nEmit_Dir0=1000*Emit_Dir0\nEmit_Dir0_FinD=1000*Emit_Dir0_FinD\n\n##(4) Produce GHG stats\nEmit_Dir1=colSums(Emit_Dir0)\nEmit_Dir1_FinD=sum(Emit_Dir0_FinD[,\"Final_Pc\"])\n\nEmit_Dir=Emit_Dir1\nEmit_Dir_FinD=Emit_Dir1_FinD\nEmit_Dir_ene=rowSums(Emit_Dir0)+Emit_Dir0_FinD$Final_Pc\nEmit_Dir_G=sum(Emit_Dir)+sum(Emit_Dir0_FinD$Final_Pc)\n\nG_name1=paste(paste(\"IO_E_G1\",t,sep=\"_\"),\"Rdata\",sep=\".\")\n\nsave(list=ls(), file=G_name1)\n\n",
    "created" : 1459990004351.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2425242732",
    "id" : "EE6EA0CF",
    "lastKnownWriteTime" : 1459993865,
    "path" : "C:/Users/sungw/OneDrive/work_2016/0000_Hybrid_2nd/CGE/SAM/GTAP_K_R/Emissions_Estimation/GHG_fuel.r",
    "project_path" : "GHG_fuel.r",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}