{
    "contents" : "## load sam aggregation function\nsource(\"agg_1223.r\")\nsource(\"agg_ghg_1223.r\")\nsource(\"sam_2010.r\")\n\n### A. Model SAM\n## input should be prepared as follows.\n#STEP 1: Size.SAM Determine the size of SAM   \n\nind=49\ngreen=1\nfac=2\nh=1\ngov=1\nNres=1\ntax=4\nS_I=1\nROW=1\n\nSize.Sam=c(ind,green,fac,h,gov,Nres,tax,S_I,ROW)\n\n#STEP 2: data.out : NON I-O data\n\nYTAX=83753*1000\nTRANSFER=39046*1000\n\ndata.out=c(YTAX,TRANSFER)\n\n# STEP 3: I-O data\n##load I-O data (model)\nIO_model=read.csv(\"IO_model_1223.csv\",header=T, as.is=T)\nrownames(IO_model)=IO_model[,1]\nIO_model=IO_model[,-1]\n# clean up IO: getting rid of subsums\nn_totalrow=c(\"idinput1\", \"idinput2\", \"VA\", \"Tinput\")\nn_totalcol=c(\"Dint\", \"Dfin\", \"Dtotal\", \"Qtotal\",\"Stotal_b\",\"Contotal\",\"Stotal_p\" )\nIO_model1=IO_model[is.na(match(rownames(IO_model),n_totalrow)),]\nIO_model2=IO_model1[,is.na(match(colnames(IO_model),n_totalcol))]\n\n\nDIO=as.matrix(IO_model2)\n\nSAM_model=data.frame(SAM_agg_basic(Size.Sam,data.out,DIO))\n\nm_ind_name=rownames(IO_model2)[1:ind]\nm_Activity_name=paste(m_ind_name,\"-a\",sep=\"\")\nm_commodity_name=paste(m_ind_name,\"-c\",sep=\"\")\nfactor_name=c(\"Labor\",\"Capital\")\nInst_name1=c(\"Household\",\"GoV\",\"NRES\")\ntax_name=c(\"Ptaxin\",\"Ptaxetc\",\"Tarrif\",\"YTAX\")\nInst_name2=c(\"S-I\",\"ROW\")\nmodel_SAM_name=c(m_Activity_name,\"CO2-a\",m_commodity_name,\"CO2-c\",factor_name,Inst_name1,tax_name,Inst_name2)\nrownames(SAM_model)=model_SAM_name\ncolnames(SAM_model)=model_SAM_name\n\n### B. Group SAM\n\nind_g=8\nSize_g.Sam=c(ind_g,green,fac,h,gov,Nres,tax,S_I,ROW)\n\n# I-O data_group\n##load I-O data (Group)\nIO_group=read.csv(\"IO_group_1223.csv\",header=T, as.is=T)\nrownames(IO_group)=IO_group[,1]\nIO_group=IO_group[,-1]\n# clean up IO: getting rid of subsums\nn_totalrow=c(\"idinput1\", \"idinput2\", \"VA\", \"Tinput\")\nn_totalcol=c(\"Dint\", \"Dfin\", \"Dtotal\", \"Qtotal\",\"Stotal_b\",\"Contotal\",\"Stotal_p\" )\nIO_group1=IO_group[is.na(match(rownames(IO_group),n_totalrow)),]\nIO_group2=IO_group1[,is.na(match(colnames(IO_group),n_totalcol))]\n\nDIO_g=as.matrix(IO_group2)\n\nSAM_group=data.frame(SAM_agg_basic(Size_g.Sam,data.out,DIO_g))\n\ng_ind_name=rownames(IO_group2)[1:ind_g]\ng_Activity_name=paste(g_ind_name,\"-a\",sep=\"\")\ng_commodity_name=paste(g_ind_name,\"-c\",sep=\"\")\ngroup_SAM_name=c(g_Activity_name,\"CO2-a\",g_commodity_name,\"CO2-c\",factor_name,Inst_name1,tax_name,Inst_name2)\nrownames(SAM_group)=group_SAM_name\ncolnames(SAM_group)=group_SAM_name\n\n\n### C. Boehringer and Rutherford SAM\n\nind_br=19\nSize_br.Sam=c(ind_br,green,fac,h,gov,Nres,tax,S_I,ROW)\n\n# I-O data_group\n##load I-O data (Group)\nIO_BR=read.csv(\"IO_BR_1223.csv\",header=T, as.is=T)\nrownames(IO_BR)=IO_BR[,1]\nIO_BR=IO_BR[,-1]\n# clean up IO: getting rid of subsums\nn_totalrow=c(\"idinput1\", \"idinput2\", \"VA\", \"Tinput\")\nn_totalcol=c(\"Dint\", \"Dfin\", \"Dtotal\", \"Qtotal\",\"Stotal_b\",\"Contotal\",\"Stotal_p\" )\nIO_BR1=IO_BR[is.na(match(rownames(IO_BR),n_totalrow)),]\nIO_BR2=IO_BR1[,is.na(match(colnames(IO_BR),n_totalcol))]\n\nDIO_BR=as.matrix(IO_BR2)\n\nSAM_BR=data.frame(SAM_agg_basic(Size_br.Sam,data.out,DIO_BR))\n\nbr_ind_name=rownames(IO_BR2)[1:ind_br]\nbr_Activity_name=paste(br_ind_name,\"-a\",sep=\"\")\nbr_commodity_name=paste(br_ind_name,\"-c\",sep=\"\")\nBR_SAM_name=c(br_Activity_name,\"CO2-a\",br_commodity_name,\"CO2-c\",factor_name,Inst_name1,tax_name,Inst_name2)\nrownames(SAM_BR)=BR_SAM_name\ncolnames(SAM_BR)=BR_SAM_name\n\n### D. add GHG total\n\nGHG_model=read.csv(file=\"GHG_model_p_1223.csv\",header=T,as.is=T)\n#GHG_model[,(2:dim(GHG_model)[2])]=GHG_model[,(2:dim(GHG_model)[2])]/100000 # in 100,000 ton\nrownames(GHG_model)=GHG_model$X\n\nSAM_model=SAM_model/1000 #1,000,000,000 won\n\n#replace negative capital cost to mimimum positive capital cost ratio to Total cost*total cost\nKTC_ratio=SAM_model[\"Capital\",1:ind]/colSums(SAM_model[,1:ind])\nminK_ind=which(SAM_model[\"Capital\",]<0)\naltK=colSums(SAM_model[,1:ind])*min(KTC_ratio[KTC_ratio>0])\ndK=altK-SAM_model[\"Capital\",1:ind]\n\n##step 1. change capital cost\nSAM_model_k1=SAM_model\nSAM_model_k1[\"Capital\",minK_ind]=altK[minK_ind]\n##Step 2. change ptaxin to make up for increased cost (government subsidy is given to guarantee mimimum surplus)\nSAM_model_k2=SAM_model_k1\nSAM_model_k2[\"Ptaxin\",minK_ind]=SAM_model_k2[\"Ptaxin\",minK_ind]-dK[minK_ind]\n##Step 3. change household capital income (matching inreased capital cost)\nSAM_model_k3=SAM_model_k2\nSAM_model_k3[\"Household\",\"Capital\"]=sum(SAM_model_k3[\"Capital\",])\n##Step 4. change government ptaxin revenue (subtracting subsidy to guarantee miminum surplus)\nSAM_model_k4=SAM_model_k3\nSAM_model_k4[\"GoV\",\"Ptaxin\"]=sum(SAM_model_k4[\"Ptaxin\",])\n##Step 5. adjust household saving and government saving \nSAM_model_k5=SAM_model_k4\nSAM_model_k5[\"S-I\",\"Household\"]=sum(SAM_model_k5[\"Household\",])-(sum(SAM_model_k5[,\"Household\"])-SAM_model_k5[\"S-I\",\"Household\"])\nSAM_model_k5[\"S-I\",\"GoV\"]=sum(SAM_model_k5[\"GoV\",])-(sum(SAM_model_k5[,\"GoV\"])-SAM_model_k5[\"S-I\",\"GoV\"])\n\nSAM_model_ng=SAM_model\nSAM_model[\"CO2-c\",(1:ind)]=as.numeric(GHG_model[\"Total\",(2:(ind+1))])\nSAM_model[\"GoV\",\"CO2-a\"]=sum(GHG_model[\"Total\",(2:(ind+1))])\nSAM_model[\"CO2-a\",\"CO2-c\"]=sum(GHG_model[\"Total\",(2:(ind+1))])\nSAM_model[(1:ind),\"GoV\"]=as.numeric(GHG_model[\"Total\",(2:(ind+1))])\n\ncheck_model=max(abs(colSums(SAM_model)-rowSums(SAM_model)))\ncheck_model\n\n\nSAM_model_ng_pos=SAM_model_k5\nSAM_model_k5[\"CO2-c\",(1:ind)]=as.numeric(GHG_model[\"Total\",(2:(ind+1))])\nSAM_model_k5[\"GoV\",\"CO2-a\"]=sum(GHG_model[\"Total\",(2:(ind+1))])\nSAM_model_k5[\"CO2-a\",\"CO2-c\"]=sum(GHG_model[\"Total\",(2:(ind+1))])\nSAM_model_k5[(1:ind),\"GoV\"]=as.numeric(GHG_model[\"Total\",(2:(ind+1))])\n\ncheck_model_5=max(abs(colSums(SAM_model_k5)-rowSums(SAM_model_k5)))\ncheck_model_5\n\n\nGHG_GR=read.csv(file=\"GHG_GR_p_1223.csv\",header=T, as.is=T)\n#GHG_GR[,(2:dim(GHG_GR)[2])]=GHG_GR[,(2:dim(GHG_GR)[2])]/100000 # in 100,000 ton\nrownames(GHG_GR)=GHG_GR$X\n\nSAM_gr=SAM_group/1000\nSAM_gr_ng=SAM_gr\nSAM_gr[\"CO2-c\",(1:ind_g)]=as.numeric(GHG_GR[\"Total\",(2:(ind_g+1))])\nSAM_gr[\"GoV\",\"CO2-a\"]=sum(GHG_GR[\"Total\",(2:(ind_g+1))])\nSAM_gr[\"CO2-a\",\"CO2-c\"]=sum(GHG_GR[\"Total\",(2:(ind_g+1))])\nSAM_gr[(1:ind_g),\"GoV\"]=as.numeric(GHG_GR[\"Total\",(2:(ind_g+1))])\ncheck_gr=max(abs(colSums(SAM_gr)-rowSums(SAM_gr)))\ncheck_gr\n\n\nGHG_BR=read.csv(file=\"GHG_BR_p_1223.csv\",header=T, as.is=T)\n#GHG_BR[,(2:dim(GHG_BR)[2])]=GHG_BR[,(2:dim(GHG_BR)[2])]/100000 # in 100,000 ton\nrownames(GHG_BR)=GHG_BR$X\n\nSAM_br=SAM_BR/1000\nSAM_br_ng=SAM_br\nSAM_br[\"CO2-c\",(1:ind_br)]=as.numeric(GHG_BR[\"Total\",(2:(ind_br+1))])\nSAM_br[\"GoV\",\"CO2-a\"]=sum(GHG_BR[\"Total\",(2:(ind_br+1))])\nSAM_br[\"CO2-a\",\"CO2-c\"]=sum(GHG_BR[\"Total\",(2:(ind_br+1))])\nSAM_br[(1:ind_br),\"GoV\"]=as.numeric(GHG_BR[\"Total\",(2:(ind_br+1))])\ncheck_br=max(abs(colSums(SAM_br)-rowSums(SAM_br)))\ncheck_br\n\n##adjust rice and barley TD-BU inconsistency\n\nSAM_br_adj=SAM_br_ng\ndRC0=rowSums(SAM_br)-colSums(SAM_br)\n### step 0. obtain adjusting factor\nRiceBarley_new=read.csv(\"ricebarley_new.csv\",header=T,as.is=T)\nRiceBarley_new$Group.1[RiceBarley_new$Group.1==\"Nres\"]=\"NRES\"\n\n### Step 1. input adjust\nSAM_br_adj[match(RiceBarley_new$Group.1,rownames(SAM_br_adj)),c(\"Rice-a\",\"Barley-a\")]=(RiceBarley_new[,(3:4)]/1000)\ndRC1=rowSums(SAM_br_adj)-colSums(SAM_br_adj)\nprint(\"DRC1\")\nprint(dRC1)\n\nSAM_br_adj2=SAM_br_adj\n\n### Step 2.dom productio adjustment\n\nSAM_br_adj2[\"Rice-a\",\"Rice-c\"]=sum(SAM_br_adj[,\"Rice-a\"])\nSAM_br_adj2[\"Barley-a\",\"Barley-c\"]=sum(SAM_br_adj[,\"Barley-a\"])\n\ndRC2=rowSums(SAM_br_adj2)-colSums(SAM_br_adj2)\nprint(\"DRC2\")\nprint(dRC2)\n\n\nSAM_br_adj3=SAM_br_adj2\n\n# Step 3: consumption adjustment subtract Rowsum-Colsum in commodity columns from consumption and investment\n## subtract from household consumption if C-(Rowsum-colsum)>0\n## subtract from investment if C-(Rowsum-colsum)<=0 \nadjC_index=(which(SAM_br_adj2[((nBR+2):(2*nBR+1)),\"Household\"]>=dRC2[((nBR+2):(2*nBR+1))]))+nBR+1\nSAM_br_adj3[adjC_index,\"Household\"]=SAM_br_adj2[adjC_index,\"Household\"]-dRC2[adjC_index]\n\nadjI_index=(which(SAM_br_adj2[((nBR+2):(2*nBR+1)),\"Household\"]<dRC2[((nBR+2):(2*nBR+1))]))+nBR+1\nSAM_br_adj3[adjI_index,\"S-I\"]=SAM_br_adj2[adjI_index,\"S-I\"]-dRC2[adjI_index]\n\ndRC3=rowSums(SAM_br_adj3)-colSums(SAM_br_adj3)\nprint(\"DRC3\")\nprint(dRC3)\n\n#step 4: Factor income and tax revenue adjusment\nSAM_br_adj4=SAM_br_adj3\nSAM_br_adj4[\"Household\",\"Labor\"]=sum(SAM_br_adj3[\"Labor\",])\nSAM_br_adj4[\"Household\",\"Capital\"]=sum(SAM_br_adj3[\"Capital\",])\nSAM_br_adj4[\"GoV\",\"Ptaxin\"]=sum(SAM_br_adj3[\"Ptaxin\",])\nSAM_br_adj4[\"GoV\",\"Ptaxetc\"]=sum(SAM_br_adj3[\"Ptaxetc\",])\n\ndRC4=rowSums(SAM_br_adj4)-colSums(SAM_br_adj4)\nprint(\"DRC4\")\nprint(dRC4)\n\n#step 5: Residue income adjustment\n\nSAM_br_adj5=SAM_br_adj4\n\nres_r=SAM_br_adj4[,\"NRES\"]/sum(SAM_br_adj4[,\"NRES\"])\nadj_nres=dRC4[\"NRES\"]*res_r\n\nSAM_br_adj5[,\"NRES\"]=SAM_br_adj4[,\"NRES\"]+adj_nres\n\ndRC5=rowSums(SAM_br_adj5)-colSums(SAM_br_adj5)\nprint(\"DRC5\")\nprint(dRC5)\n\n#step 6: Household, Govenrment Savings Adjustment\n\nSAM_br_adj6=SAM_br_adj5\n\nSAM_br_adj6[\"S-I\",\"Household\"]=sum(SAM_br_adj5[\"Household\",])-sum(SAM_br_adj5[-which(rownames(SAM_br_adj5)==\"S-I\"),\"Household\"])\nSAM_br_adj6[\"S-I\",\"GoV\"]=sum(SAM_br_adj5[\"GoV\",])-sum(SAM_br_adj5[-which(rownames(SAM_br_adj5)==\"S-I\"),\"GoV\"])\n\ndRC6=rowSums(SAM_br_adj6)-colSums(SAM_br_adj6)\nprint(\"DRC6\")\nprint(dRC6)\n\n\n\nSAM_br_adj_ng=SAM_br_adj6\n\n#step 7:GHG adjustment\n\nGHG_BR_adj=GHG_BR\n\nGHG_BR_adj[\"GASHeat-c\",\"Rice.a\"]=rowSums(GHG_BR[\"GASHeat-c\",c(\"Rice.a\",\"Barley.a\")])*SAM_br_adj_ng[\"GASHeat-c\",\"Rice-a\"]/sum(SAM_br_adj_ng[\"GASHeat-c\",c(\"Rice-a\",\"Barley-a\")])\nGHG_BR_adj[\"GASHeat-c\",\"Barley.a\"]=rowSums(GHG_BR[\"GASHeat-c\",c(\"Rice.a\",\"Barley.a\")])*SAM_br_adj_ng[\"GASHeat-c\",\"Barley-a\"]/sum(SAM_br_adj_ng[\"GASHeat-c\",c(\"Rice-a\",\"Barley-a\")])\n\nGHG_BR_adj[\"OIL-c\",\"Rice.a\"]=rowSums(GHG_BR[\"OIL-c\",c(\"Rice.a\",\"Barley.a\")])*SAM_br_adj_ng[\"OIL-c\",\"Rice-a\"]/sum(SAM_br_adj_ng[\"OIL-c\",c(\"Rice-a\",\"Barley-a\")])\nGHG_BR_adj[\"OIL-c\",\"Barley.a\"]=rowSums(GHG_BR[\"OIL-c\",c(\"Rice.a\",\"Barley.a\")])*SAM_br_adj_ng[\"OIL-c\",\"Barley-a\"]/sum(SAM_br_adj_ng[\"OIL-c\",c(\"Rice-a\",\"Barley-a\")])\n\n#GHG_BR_adj[\"COAL-c\",\"Rice.a\"]=rowSums(GHG_BR[\"COAL-c\",c(\"Rice.a\",\"Barley.a\")])*SAM_br_adj_ng[\"COAL-c\",\"Rice-a\"]/sum(SAM_br_adj_ng[\"COAL-c\",c(\"Rice-a\",\"Barley-a\")])\n#GHG_BR_adj[\"COAL-c\",\"Barley.a\"]=rowSums(GHG_BR[\"COAL-c\",c(\"Rice.a\",\"Barley.a\")])*SAM_br_adj_ng[\"COAL-c\",\"Barley-a\"]/sum(SAM_br_adj_ng[\"COAL-c\",c(\"Rice-a\",\"Barley-a\")])\n\nGHG_BR_adj[\"process\",\"Rice.a\"]=rowSums(GHG_BR[\"process\",c(\"Rice.a\",\"Barley.a\")])*sum(SAM_br_adj_ng[,\"Rice-a\"])/sum(SAM_br_adj_ng[,c(\"Rice-a\",\"Barley-a\")])\nGHG_BR_adj[\"process\",\"Barley.a\"]=rowSums(GHG_BR[\"process\",c(\"Rice.a\",\"Barley.a\")])*sum(SAM_br_adj_ng[,\"Barley-a\"])/sum(SAM_br_adj_ng[,c(\"Rice-a\",\"Barley-a\")])\n\nGHG_BR_adj=GHG_BR_adj[,-1]\ndim_GHGadj=dim(GHG_BR_adj)\n\nGHG_BR_adj[\"Total\",]=colSums(GHG_BR_adj[(1:(dim_GHGadj[1]-1)),])\nGHG_BR_adj[,\"Total\"]=rowSums(GHG_BR_adj[,(1:(dim_GHGadj[2]-1))])\ncolnames(GHG_BR_adj)[1:nBR]=colnames(SAM_br_adj_ng)[1:nBR]\n\n#step 8:add CO2\n\nSAM_br_adj_g=SAM_br_adj6\nSAM_br_adj_g[\"CO2-c\",(1:ind_br)]=as.numeric(GHG_BR_adj[\"Total\",(1:ind_br)])\nSAM_br_adj_g[\"GoV\",\"CO2-a\"]=sum(GHG_BR_adj[\"Total\",(1:ind_br)])\nSAM_br_adj_g[\"CO2-a\",\"CO2-c\"]=sum(GHG_BR_adj[\"Total\",(1:ind_br)])\nSAM_br_adj_g[(1:ind_br),\"GoV\"]=as.numeric(GHG_BR_adj[\"Total\",(1:ind_br)])\ncheck_br_adj=max(abs(colSums(SAM_br_adj_g)-rowSums(SAM_br_adj_g)))\ncheck_br_adj\n\n#write.csv(SAM_model_ng,file=\"b_sam_model_ng_1223.csv\")\n#write.csv(SAM_gr_ng,file=\"b_sam_group_ng_1223.csv\")\n#write.csv(SAM_br_ng,file=\"b_sam_br_ng_1223.csv\")\n#write.csv(SAM_br_adj_ng,file=\"b_sam_br_ng_20160117.csv\")\nwrite.csv(SAM_br_adj_ng,file=\"b_sam_br_ng_20160119.csv\")\n\n#write.csv(SAM_model,file=\"b_sam_model_g_1223.csv\")\n#write.csv(SAM_gr,file=\"b_sam_group_g_1223.csv\")\n#write.csv(SAM_br,file=\"b_sam_br_g_1223.csv\")\n#write.csv(SAM_br_adj_g,file=\"b_sam_br_g_20160117.csv\")\n#write.csv(GHG_BR_adj,file=\"GHG_BR_p_20160117.csv\")\nwrite.csv(SAM_br_adj_g,file=\"b_sam_br_g_20160119.csv\")\nwrite.csv(GHG_BR_adj,file=\"GHG_BR_p_20160119.csv\")\n\n#write.csv(SAM_model_ng_pos,file=\"b_sam_model_ng_pos_1223.csv\")\n#write.csv(SAM_model_k5,file=\"b_sam_model_g_pos_1223.csv\")",
    "created" : 1469085122889.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1726616736",
    "id" : "63F767E4",
    "lastKnownWriteTime" : 1469085162,
    "path" : "C:/Users/sungw/OneDrive/work_2016/0000_Hybrid_2nd/CGE/SAM/Agri/samconst_2010_pos_20160119_BUadj.R",
    "project_path" : "samconst_2010_pos_20160119_BUadj.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}